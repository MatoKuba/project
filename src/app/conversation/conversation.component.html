<!-- Main container for the chat application -->
<div class="conversation-container">

  <!-- Header section, containing the back button, editable title, and profile picture -->
  <div class="header">
    <!-- Back button for navigation -->
    <button class="back-button" routerLink="/hub">&larr;</button>

    <!-- Editable conversation title -->
    <h2 contenteditable="true" #titleElement (blur)="updateConversationTitle(titleElement.innerText)" [innerText]="conversation?.title"></h2>

    <!-- Profile picture -->
    <img class="profile-pic" src="https://via.placeholder.com/40" alt="Profile" />
  </div>

  <!-- Messages section for displaying chat messages -->
  <div class="messages">
    <!-- Loop through conversation messages -->
    <ng-container *ngFor="let message of conversation?.messages; let i = index">
      <!-- Date stamp for the current message -->
      <div class="date-stamp" *ngIf="shouldShowDate(i)">{{ message.timestamp | date: 'shortDate' }}</div>

      <!-- Message wrapper with conditional class for sender's messages -->
      <div class="message-wrapper" [ngClass]="{ 'message-wrapper--first': isFirstMessage(i) }">
        <!-- Check if the current message is the first message from the sender -->
        <ng-container *ngIf="isFirstMessage(i)">
          <!-- Display the sender's name -->
          <div class="message__sender">{{ getSenderName(message.senderId) }}</div>
        </ng-container>

        <!-- Message container with conditional class for sender's messages -->
        <div class="message" [ngClass]="{ 'message--mine': message.senderId === 1 }">
          <!-- Display the message content -->
          <div class="message__content">{{ message.content }}</div>

          <!-- Display the message timestamp -->
          <div class="message__timestamp">{{ message.timestamp | date: 'shortTime' }}</div>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Footer section for composing and sending messages -->
  <div class="footer">
    <!-- Textarea for composing messages -->
    <textarea
      [(ngModel)]="messageText"
      (input)="adjustTextareaHeight()"
      (keydown.enter)="sendMessage(); $event.preventDefault()"
      #messageInput
      class="message-input"
      placeholder="Type a message..."
    ></textarea>

    <!-- Send button for submitting messages -->
    <button class="send-button" (click)="sendMessage()"><span class="material-icons">send</span></button>

    <!-- Attach button for adding files -->
    <button class="attach-button"><span class="material-icons">attach_file</span></button>
  </div>
</div>
